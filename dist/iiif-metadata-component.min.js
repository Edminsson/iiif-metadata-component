// iiif-metadata-component v1.0.0 https://github.com/viewdir/iiif-metadata-component#readme
!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.iiifMetadataComponent=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var IIIFComponents;!function(IIIFComponents){var StringValue=function(){function StringValue(value){this.value="",value&&(this.value=value.toLowerCase())}return StringValue.prototype.toString=function(){return this.value},StringValue}();IIIFComponents.StringValue=StringValue}(IIIFComponents||(IIIFComponents={}));var IIIFComponents,__extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)};!function(IIIFComponents){var LimitType=function(_super){function LimitType(){_super.apply(this,arguments)}return __extends(LimitType,_super),LimitType.LINES=new LimitType("lines"),LimitType.CHARS=new LimitType("chars"),LimitType}(IIIFComponents.StringValue);IIIFComponents.LimitType=LimitType}(IIIFComponents||(IIIFComponents={}));var IIIFComponents,__extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)};!function(IIIFComponents){var MetadataComponent=function(_super){function MetadataComponent(options){_super.call(this,options),this._init(),this._resize()}return __extends(MetadataComponent,_super),MetadataComponent.prototype._init=function(){var success=_super.prototype._init.call(this);return success||console.error("Component failed to initialise"),this._$moreInfoItemTemplate=$('<div class="item">                                                   <div class="header"></div>                                                   <div class="text"></div>                                               </div>'),this._$copyTextTemplate=$('<div class="copyText" alt="'+this.options.content.copyToClipboard+'" title="'+this.options.content.copyToClipboard+'">                                                   <div class="copiedText">'+this.options.content.copiedToClipboard+" </div>                                               </div>"),this._$items=$('<div class="items"></div>'),this._$element.append(this._$items),this._$canvasItems=$('<div class="items"></div>'),this._$element.append(this._$canvasItems),this._$noData=$('<div class="noData">'+this.options.content.noData+"</div>"),this._$element.append(this._$noData),this._aggregateValuesConfig=this._readCSV(this.options.aggregateValues),this._canvasExcludeConfig=this._readCSV(this.options.canvasExclude),success},MetadataComponent.prototype._getDefaultOptions=function(){return{aggregateValues:"",canvasExclude:"",content:{attribution:"Attribution",canvasHeader:"About the image",copiedToClipboard:"Copied to clipboard",copyToClipboard:"Copy to clipboard",description:"Description",less:"less",license:"License",logo:"Logo",manifestHeader:"About the item",more:"more",noData:"No data to display"},copyToClipboardEnabled:!1,displayOrder:"",helper:null,limit:4,limitType:IIIFComponents.LimitType.LINES.toString(),manifestExclude:"",sanitizer:function(html){return html}}},MetadataComponent.prototype.databind=function(){if(this._manifestData=this.options.helper.getMetadata(),this.options.displayOrder&&(this._manifestData=this._sort(this._manifestData,this._readCSV(this.options.displayOrder))),this.options.manifestExclude&&(this._manifestData=this._exclude(this._manifestData,this._readCSV(this.options.manifestExclude))),this._manifestData=this._flatten(this._manifestData),this._canvasData=this._getCanvasData(this.options.helper.getCurrentCanvas()),0===this._manifestData.length&&0===this._canvasData.length)return void this._$noData.show();this._$noData.hide();var manifestRenderData=$.extend(!0,[],this._manifestData),canvasRenderData=$.extend(!0,[],this._canvasData);this._aggregateValues(manifestRenderData,canvasRenderData),this._renderElement(this._$items,manifestRenderData,this.options.content.manifestHeader,0!==canvasRenderData.length),this._renderElement(this._$canvasItems,canvasRenderData,this.options.content.canvasHeader,0!==manifestRenderData.length)},MetadataComponent.prototype._sort=function(data,displayOrder){var sorted=[];return $.each(displayOrder,function(index,item){var match=data.en().where(function(x){return x.label.toLowerCase()===item}).first();match&&(sorted.push(match),data.remove(match))}),$.each(data,function(item){sorted.push(item)}),sorted},MetadataComponent.prototype._exclude=function(data,excludeConfig){var excluded=$.extend(!0,[],data);return $.each(excludeConfig,function(index,item){var match=excluded.en().where(function(x){return x.label.toLowerCase()===item}).first();match&&excluded.remove(match)}),excluded},MetadataComponent.prototype._flatten=function(data){var flattened=[];return $.each(data,function(index,item){Array.isArray(item.value)?flattened=flattened.concat(item.value):flattened.push(item)}),flattened},MetadataComponent.prototype._aggregateValues=function(fromData,toData){var _this=this;0!==this._aggregateValuesConfig.length&&$.each(toData,function(index,item){$.each(_this._aggregateValuesConfig,function(index,value){if(item.label.toLowerCase()===value){var manifestIndex=fromData.en().where(function(x){return x.label.toLowerCase()===value.toLowerCase()}).first().index();if(manifestIndex!==-1){var data=fromData.splice(manifestIndex,1)[0];item.value=data.value+item.value}}})})},MetadataComponent.prototype._renderElement=function(element,data,header,renderHeader){var _this=this;element.empty(),0!==data.length&&(renderHeader&&header&&element.append(this._buildHeader(header)),$.each(data,function(index,item){var built=_this._buildItem(item);element.append(built),_this.options.limitType===IIIFComponents.LimitType.LINES.toString()?built.find(".text").toggleExpandTextByLines(_this.options.limit,_this.options.content.less,_this.options.content.more):_this.options.limitType===IIIFComponents.LimitType.CHARS.toString()&&built.find(".text").ellipsisHtmlFixed(_this.options.limit,null)}))},MetadataComponent.prototype._buildHeader=function(label){var $header=$('<div class="header"></div>');return $header.html(this._sanitize(label)),$header},MetadataComponent.prototype._buildItem=function(item){var $elem=this._$moreInfoItemTemplate.clone(),$header=$elem.find(".header"),$text=$elem.find(".text");if(item.label=this._sanitize(item.label),item.value=this._sanitize(item.value),item.isRootLevel)switch(item.label.toLowerCase()){case"attribution":item.label=this.options.content.attribution;break;case"description":item.label=this.options.content.description;break;case"license":item.label=this.options.content.license;break;case"logo":item.label=this.options.content.logo}return item.value=item.value.replace("\n","<br>"),$header.html(item.label),$text.html(item.value),$text.targetBlank(),item.label=item.label.trim(),item.label=item.label.toLowerCase(),$elem.addClass(item.label.toCssClass()),this.options.copyToClipboardEnabled&&Utils.Clipboard.supportsCopy()&&$text.text()&&$header.text()&&this._addCopyButton($elem,$header),$elem},MetadataComponent.prototype._addCopyButton=function($elem,$header){var _this=this,$copyBtn=this._$copyTextTemplate.clone(),$copiedText=$copyBtn.children();$header.append($copyBtn),Utils.Device.isTouch()?$copyBtn.show():($elem.on("mouseenter",function(){$copyBtn.show()}),$elem.on("mouseleave",function(){$copyBtn.hide()}),$copyBtn.on("mouseleave",function(){$copiedText.hide()})),$copyBtn.on("click",function(e){var imgElement=e.target,headerText=imgElement.previousSibling.textContent||imgElement.previousSibling.nodeValue;_this._copyValueForLabel(headerText)})},MetadataComponent.prototype._copyValueForLabel=function(label){var manifestItems=this._flatten(this._manifestData),canvasItems=this._flatten(this._canvasData),$matchingItems=$(manifestItems.concat(canvasItems)).filter(function(i,md){return md.label&&label&&md.label.toLowerCase()===label.toLowerCase()}),text=$matchingItems.map(function(i,md){return md.value}).get().join("");if(text){Utils.Clipboard.copy(text);var $copiedText=$(".items .item .header:contains("+label+") .copiedText");$copiedText.show(),setTimeout(function(){$copiedText.hide()},2e3)}},MetadataComponent.prototype._getCanvasData=function(canvas){var data=this.options.helper.getCanvasMetadata(canvas);return 0!==this._canvasExcludeConfig.length&&(data=this._exclude(data,this._canvasExcludeConfig)),this._flatten(data)},MetadataComponent.prototype._readCSV=function(config){return config?config.toLowerCase().replace(/ /g,"").split(","):[]},MetadataComponent.prototype._sanitize=function(html){return this.options.sanitizer(html)},MetadataComponent.prototype._resize=function(){},MetadataComponent}(_Components.BaseComponent);IIIFComponents.MetadataComponent=MetadataComponent}(IIIFComponents||(IIIFComponents={}));var IIIFComponents;!function(IIIFComponents){var MetadataComponent;!function(MetadataComponent){var Events=function(){function Events(){}return Events}();MetadataComponent.Events=Events}(MetadataComponent=IIIFComponents.MetadataComponent||(IIIFComponents.MetadataComponent={}))}(IIIFComponents||(IIIFComponents={})),function(w){w.IIIFComponents?w.IIIFComponents.MetadataComponent=IIIFComponents.MetadataComponent:w.IIIFComponents=IIIFComponents}(window)},{}]},{},[1])(1)});